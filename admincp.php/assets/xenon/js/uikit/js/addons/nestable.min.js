!function(t){var e;jQuery&&jQuery.UIkit&&(e=t(jQuery,jQuery.UIkit)),"function"==typeof define&&define.amd&&define("uikit-nestable",["uikit"],function(){return e||t(jQuery,jQuery.UIkit)})}(function(g,e){var n="ontouchstart"in window,o=g("html"),u=[],i=e.$win,f=function(){var t=document.createElement("div"),e=document.documentElement;if(!("pointerEvents"in t.style))return!1;t.style.pointerEvents="auto",t.style.pointerEvents="x",e.appendChild(t);var s=window.getComputedStyle&&"auto"===window.getComputedStyle(t,"").pointerEvents;return e.removeChild(t),!!s}(),l=n?"touchstart":"mousedown",d=n?"touchmove":"mousemove",r=n?"touchend":"mouseup",h=n?"touchcancel":"mouseup";return e.component("nestable",{defaults:{prefix:"uk",listNodeName:"ul",itemNodeName:"li",listBaseClass:"{prefix}-nestable",listClass:"{prefix}-nestable-list",listitemClass:"{prefix}-nestable-list-item",itemClass:"{prefix}-nestable-item",dragClass:"{prefix}-nestable-list-dragged",movingClass:"{prefix}-nestable-moving",handleClass:"{prefix}-nestable-handle",collapsedClass:"{prefix}-collapsed",placeClass:"{prefix}-nestable-placeholder",noDragClass:"{prefix}-nestable-nodrag",emptyClass:"{prefix}-nestable-empty",noChildrenClass:"{prefix}-nestable-nochildren",group:0,maxDepth:10,threshold:20},init:function(){var a=this;Object.keys(this.options).forEach(function(t){-1!=String(a.options[t]).indexOf("{prefix}")&&(a.options[t]=a.options[t].replace("{prefix}",a.options.prefix))}),this.tplempty='<div class="'+this.options.emptyClass+'"/>',this.find(">"+this.options.itemNodeName).addClass(this.options.listitemClass).end().find("ul:not(.ignore-list)").addClass(this.options.listClass).find(">li").addClass(this.options.listitemClass),this.element.children(this.options.itemNodeName).length||this.element.append(this.tplempty),this.element.data("nestable-id","ID"+(new Date).getTime()+"RAND"+Math.ceil(1e5*Math.random())),this.reset(),this.element.data("nestable-group",this.options.group),this.placeEl=g('<div class="'+this.options.placeClass+'"/>'),this.find(this.options.itemNodeName).each(function(){a.setParent(g(this))}),this.on("click","[data-nestable-action]",function(t){if(!a.dragEl&&(n||0===t.button)){t.preventDefault();var e=g(t.currentTarget),s=e.data("nestableAction"),i=e.closest(a.options.itemNodeName);"collapse"===s&&a.collapseItem(i),"expand"===s&&a.expandItem(i),"toggle"===s&&a.toggleItem(i)}});var t=function(t){var e=g(t.target);if(!e.hasClass(a.options.handleClass)){if(e.closest("."+a.options.noDragClass).length)return;e=e.closest("."+a.options.handleClass)}!e.length||a.dragEl||!n&&0!==t.button||n&&1!==t.touches.length||(t.preventDefault(),a.dragStart(n?t.touches[0]:t),a.trigger("nestable-start",[a]))},e=function(t){a.dragEl&&(t.preventDefault(),a.dragMove(n?t.touches[0]:t),a.trigger("nestable-move",[a]))},s=function(t){a.dragEl&&(t.preventDefault(),a.dragStop(n?t.touches[0]:t),a.trigger("nestable-stop",[a]))};n?(this.element[0].addEventListener(l,t,!1),window.addEventListener(d,e,!1),window.addEventListener(r,s,!1),window.addEventListener(h,s,!1)):(this.on(l,t),i.on(d,e),i.on(r,s))},serialize:function(){var n=this;return step=function(t,i){var a=[];return t.children(n.options.itemNodeName).each(function(){var t=g(this),e=g.extend({},t.data()),s=t.children(n.options.listNodeName);s.length&&(e.children=step(s,i+1)),a.push(e)}),a},step(n.element,0)},list:function(l){var o=[],d=(l=g.extend({},this.options,l),function(t,a,n){t.children(l.itemNodeName).each(function(t){var e=g(this),s=g.extend({parent_id:n||null,depth:a,order:t},e.data()),i=e.children(l.listNodeName);o.push(s),i.length&&d(i,a+1,e.data(l.idProperty||"id"))})});return d(this.element,0),o},reset:function(){this.mouse={offsetX:0,offsetY:0,startX:0,startY:0,lastX:0,lastY:0,nowX:0,nowY:0,distX:0,distY:0,dirAx:0,dirX:0,dirY:0,lastDirX:0,lastDirY:0,distAxX:0,distAxY:0},this.moving=!1,this.dragEl=null,this.dragRootEl=null,this.dragDepth=0,this.hasNewRoot=!1,this.pointEl=null;for(var t=0;t<u.length;t++)u[t].children().length||u[t].append(this.tplempty);u=[]},toggleItem:function(t){this[t.hasClass(this.options.collapsedClass)?"expandItem":"collapseItem"](t)},expandItem:function(t){t.removeClass(this.options.collapsedClass)},collapseItem:function(t){t.children(this.options.listNodeName).length&&t.addClass(this.options.collapsedClass)},expandAll:function(){var t=this;this.find(t.options.itemNodeName).each(function(){t.expandItem(g(this))})},collapseAll:function(){var t=this;this.find(t.options.itemNodeName).each(function(){t.collapseItem(g(this))})},setParent:function(t){t.children(this.options.listNodeName).length&&t.addClass("uk-parent")},unsetParent:function(t){t.removeClass("uk-parent "+this.options.collapsedClass),t.children(this.options.listNodeName).remove()},dragStart:function(t){var e=this.mouse,s=g(t.target).closest(this.options.itemNodeName),i=s.offset();this.placeEl.css("height",s.height()),e.offsetX=t.pageX-i.left,e.offsetY=t.pageY-i.top,e.startX=e.lastX=i.left,e.startY=e.lastY=i.top,this.dragRootEl=this.element,this.dragEl=g(document.createElement(this.options.listNodeName)).addClass(this.options.listClass+" "+this.options.dragClass),this.dragEl.css("width",s.width()),this.tmpDragOnSiblings=[s[0].previousSibling,s[0].nextSibling],s.after(this.placeEl),s[0].parentNode.removeChild(s[0]),s.appendTo(this.dragEl),g(document.body).append(this.dragEl),this.dragEl.css({left:i.left,top:i.top});var a,n,l=this.dragEl.find(this.options.itemNodeName);for(a=0;a<l.length;a++)(n=g(l[a]).parents(this.options.listNodeName).length)>this.dragDepth&&(this.dragDepth=n);o.addClass(this.options.movingClass)},dragStop:function(t){var e=this.dragEl.children(this.options.itemNodeName).first();e[0].parentNode.removeChild(e[0]),this.placeEl.replaceWith(e),this.dragEl.remove(),this.tmpDragOnSiblings[0]==e[0].previousSibling&&this.tmpDragOnSiblings[0]==e[0].previousSibling||(this.element.trigger("nestable-change",[e,this.hasNewRoot?"added":"moved"]),this.hasNewRoot&&this.dragRootEl.trigger("nestable-change",[e,"removed"])),this.reset(),o.removeClass(this.options.movingClass)},dragMove:function(t){var e,s,i,a=this.options,n=this.mouse;this.dragEl.css({left:t.pageX-n.offsetX,top:t.pageY-n.offsetY}),n.lastX=n.nowX,n.lastY=n.nowY,n.nowX=t.pageX,n.nowY=t.pageY,n.distX=n.nowX-n.lastX,n.distY=n.nowY-n.lastY,n.lastDirX=n.dirX,n.lastDirY=n.dirY,n.dirX=0===n.distX?0:0<n.distX?1:-1,n.dirY=0===n.distY?0:0<n.distY?1:-1;var l=Math.abs(n.distX)>Math.abs(n.distY)?1:0;if(!n.moving)return n.dirAx=l,void(n.moving=!0);n.dirAx!==l?(n.distAxX=0,n.distAxY=0):(n.distAxX+=Math.abs(n.distX),0!==n.dirX&&n.dirX!==n.lastDirX&&(n.distAxX=0),n.distAxY+=Math.abs(n.distY),0!==n.dirY&&n.dirY!==n.lastDirY&&(n.distAxY=0)),n.dirAx=l,n.dirAx&&n.distAxX>=a.threshold&&(n.distAxX=0,i=this.placeEl.prev(a.itemNodeName),0<n.distX&&i.length&&!i.hasClass(a.collapsedClass)&&!i.children("."+a.itemClass).hasClass(a.noChildrenClass)&&(e=i.find(a.listNodeName).last(),this.placeEl.parents(a.listNodeName).length+this.dragDepth<=a.maxDepth&&(e.length?(e=i.children(a.listNodeName).last()).append(this.placeEl):((e=g("<"+a.listNodeName+"/>").addClass(a.listClass)).append(this.placeEl),i.append(e),this.setParent(i)))),n.distX<0&&(this.placeEl.next(a.itemNodeName).length||(s=this.placeEl.parent(),this.placeEl.closest(a.itemNodeName).after(this.placeEl),s.children().length||this.unsetParent(s.parent()))));var o=!1;if(f||(this.dragEl[0].style.visibility="hidden"),this.pointEl=g(document.elementFromPoint(t.pageX-document.body.scrollLeft,t.pageY-(window.pageYOffset||document.documentElement.scrollTop))),f||(this.dragEl[0].style.visibility="visible"),this.pointEl.hasClass(a.handleClass))this.pointEl=this.pointEl.closest(a.itemNodeName);else{var d=this.pointEl.closest("."+a.itemClass);d.length&&(this.pointEl=d.closest(a.itemNodeName))}if(this.pointEl.hasClass(a.emptyClass))o=!0;else if(this.pointEl.data("nestable")&&!this.pointEl.children().length)o=!0,this.pointEl=g(this.tplempty).appendTo(this.pointEl);else if(!this.pointEl.length||!this.pointEl.hasClass(a.listitemClass))return;var r=this.element,h=this.pointEl.closest("."+this.options.listBaseClass),p=r[0]!==this.pointEl.closest("."+this.options.listBaseClass)[0],c=h;if(!n.dirAx||p||o){if(p&&a.group!==c.data("nestable-group"))return;if(u.push(r),this.dragDepth-1+this.pointEl.parents(a.listNodeName).length>a.maxDepth)return;var m=t.pageY<this.pointEl.offset().top+this.pointEl.height()/2;s=this.placeEl.parent(),o?this.pointEl.replaceWith(this.placeEl):m?this.pointEl.before(this.placeEl):this.pointEl.after(this.placeEl),s.children().length||s.data("nestable")||this.unsetParent(s.parent()),this.dragRootEl.find(a.itemNodeName).length||this.dragRootEl.children().length||this.dragRootEl.append(this.tplempty),p&&(this.dragRootEl=h,this.hasNewRoot=this.element[0]!==this.dragRootEl[0])}}}),e.ready(function(t){g("[data-uk-nestable]",t).each(function(){var t=g(this);if(!t.data("nestable"))e.nestable(t,e.Utils.options(t.attr("data-uk-nestable")))})}),e.nestable});